# FeedBackResolver - Project Rules & Standards

## ðŸŽ¯ **Project Overview**
FeedBackResolver is an AI-powered email feedback analysis system that integrates Gmail, NeuroLink AI, and Slack. This file defines the coding standards, conventions, and rules that must be followed when contributing to this project.

**ðŸ“š IMPORTANT**: Before making any code changes, read the complete memory bank documentation in `/memory_bank/` to understand the project context, architecture, and business goals.

---

## ðŸ”’ **Security & Environment Rules**

### Rule #1: Environment Variable Management
**MANDATORY**: All variables whose values vary based on user, environment, or contain sensitive data MUST be defined in `.env` files.

#### âœ… **Required .env Variables:**
```bash
# Gmail API Integration
GOOGLE_CLIENT_ID="[client-id]"
GOOGLE_CLIENT_SECRET="[client-secret]"
GMAIL_REFRESH_TOKEN="[refresh-token]"

# AI Processing
GOOGLE_VERTEX_PROJECT="[project-id]" 
GOOGLE_APPLICATION_CREDENTIALS="[path-to-service-account]"
GOOGLE_VERTEX_LOCATION="[region]"
NEUROLINK_DEFAULT_MODEL="[model-name]"
NEUROLINK_DEFAULT_PROVIDER="[provider-name]"

# Email Configuration
TARGET_EMAIL="[user-email]"
DAYS_TO_SEARCH="[number]"
MAX_RESULTS="[number]"

# Slack Integration
SLACK_WEBHOOK_URL="[webhook-url]"
SLACK_ENABLED="[true/false]"
```

#### ðŸš« **Never Hard-code:**
- API keys, tokens, or credentials
- Email addresses or personal information
- Webhook URLs or server endpoints
- File paths that vary by system
- Any user-specific configuration values

#### âœ… **Environment File Standards:**
- Always provide `.env.example` with placeholder values
- Use descriptive placeholder names: `[GOOGLE_CLIENT_ID]` not `[VALUE]`
- Include comments explaining what each variable does
- Validate required environment variables at application startup

### Rule #2: Credential Security
- **Never commit** real credentials to version control
- **Always use** environment variables for sensitive data
- **Document** all required credentials in `.env.example`
- **Validate** credential presence at application startup

---

## ðŸ—ï¸ **Code Architecture Rules**

### Rule #3: Module Structure
Follow the established modular architecture pattern:

```
project-root/
â”œâ”€â”€ index.js              # Main orchestration logic
â”œâ”€â”€ [module]-[function].js # Specific functionality modules
â”œâ”€â”€ get-[action].js        # Utility/helper scripts  
â”œâ”€â”€ test-[module].js       # Testing utilities
â”œâ”€â”€ .env                   # Environment configuration
â”œâ”€â”€ .env.example           # Configuration template
â””â”€â”€ package.json           # Dependencies and scripts
```

#### âœ… **File Naming Conventions:**
- Use kebab-case: `slack-notifier.js`, `get-refresh-token.js`
- Be descriptive: `email-processor.js` not `processor.js`
- Include purpose: `test-slack.js`, `validate-config.js`

### Rule #4: ES Modules Standard
**MANDATORY**: Use ES6 modules throughout the project.

#### âœ… **Import/Export Patterns:**
```javascript
// âœ… Correct ES6 imports
import { NeuroLink } from '@juspay/neurolink';
import SlackNotifier from './slack-notifier.js';
import dotenv from 'dotenv';

// âœ… Correct exports
export default SlackNotifier;
export { helperFunction, validateConfig };

// ðŸš« Avoid CommonJS
const SlackNotifier = require('./slack-notifier');
module.exports = SlackNotifier;
```

#### âœ… **Always include `.js` extension** in local imports:
```javascript
// âœ… Correct
import SlackNotifier from './slack-notifier.js';

// ðŸš« Incorrect  
import SlackNotifier from './slack-notifier';
```

---

## ðŸ›¡ï¸ **Error Handling Rules**

### Rule #5: Graceful Degradation Pattern
**MANDATORY**: System must continue operation despite component failures.

#### âœ… **Error Handling Pattern:**
```javascript
// âœ… Non-blocking error handling
try {
    await criticalOperation();
} catch (error) {
    console.error('Operation failed:', error.message);
    // Continue with fallback or next step
    // Do NOT throw unless absolutely critical
}
```

#### âœ… **Slack Integration Error Handling:**
```javascript
// âœ… Slack failure should not stop email processing
try {
    await slackNotifier.sendNotification(data);
    console.log('âœ… Slack notification sent');
} catch (error) {
    console.error('âŒ Slack notification failed:', error.message);
    // Continue - file backup still works
}
```

### Rule #6: Error Logging Standards
- **Always log errors** with descriptive messages
- **Include context** but never log sensitive data
- **Use consistent emoji** indicators: âœ… success, âŒ error, âš ï¸ warning
- **Never log email content** or user data

#### âœ… **Logging Pattern:**
```javascript
// âœ… Good error logging
console.error('âŒ Gmail API authentication failed:', error.message);
console.log('ðŸ“¤ Sending notification to Slack...');
console.log('âœ… Analysis complete. Report saved.');

// ðŸš« Never log sensitive data
console.error('Error with email:', emailContent); // BAD
console.error('Failed with token:', refreshToken); // BAD
```

---

## ðŸ¤– **AI Integration Rules**

### Rule #7: NeuroLink Usage Standards
**MANDATORY**: Use NeuroLink for all AI operations, never direct provider APIs.

#### âœ… **NeuroLink Configuration:**
```javascript
const neurolink = new NeuroLink();

const response = await neurolink.generate({
    input: { text: promptText },
    provider: process.env.NEUROLINK_DEFAULT_PROVIDER,
    timeout: "30000s"
});
```

#### âœ… **AI Response Handling:**
```javascript
// âœ… Always handle malformed responses
const parsed = extractJsonFromCodeBlock(response.content);
if (!parsed || typeof parsed.requiredField !== 'string') {
    console.warn("Invalid AI response format");
    return defaultFallback();
}
```

### Rule #8: AI Prompt Engineering
- **Be specific** in prompts about expected output format
- **Include examples** of desired JSON structure
- **Handle malformed responses** gracefully
- **Use timeouts** to prevent hanging operations

---

## ðŸ“ **Configuration Management Rules**

### Rule #9: Environment Validation
**MANDATORY**: Validate all required environment variables at startup.

#### âœ… **Startup Validation Pattern:**
```javascript
// âœ… Required validation
const requiredVars = ['GOOGLE_CLIENT_ID', 'GOOGLE_CLIENT_SECRET'];
for (const varName of requiredVars) {
    if (!process.env[varName]) {
        throw new Error(`Missing required environment variable: ${varName}`);
    }
}
```

### Rule #10: Default Values
Provide sensible defaults for non-sensitive configuration:

#### âœ… **Default Value Pattern:**
```javascript
// âœ… Good defaults with validation
const daysToSearch = (DAYS_TO_SEARCH && !isNaN(parseInt(DAYS_TO_SEARCH))) 
    ? DAYS_TO_SEARCH 
    : '10';

const maxResults = (MAX_RESULTS && parseInt(MAX_RESULTS) > 0) 
    ? parseInt(MAX_RESULTS) 
    : 20;
```

---

## ðŸ“Š **Data Handling Rules**

### Rule #11: Privacy by Design
**MANDATORY**: Minimize data storage and protect user privacy.

#### âœ… **Data Storage Rules:**
- **Store only** email IDs for deduplication
- **Never persist** email content beyond processing
- **Process and discard** sensitive information immediately
- **Use minimal retention** for tracking files

#### âœ… **State Management:**
```javascript
// âœ… Only store necessary IDs
const processedEmails = ['emailId1', 'emailId2'];

// ðŸš« Never store content
const processedEmails = {
    'emailId1': { content: 'email content' } // BAD
};
```

---

## ðŸ§ª **Testing Rules**

### Rule #12: Test Utilities
**MANDATORY**: Provide test utilities for all external integrations.

#### âœ… **Testing Standards:**
- Create `test-[module].js` files for integration testing
- Test external connections (Slack, Gmail, AI) separately
- Provide clear success/failure messages
- Include setup validation in test utilities

#### âœ… **Test File Pattern:**
```javascript
// test-slack.js example
async function testSlackConnection() {
    console.log('ðŸ§ª Testing Slack connection...');
    
    try {
        const result = await slackNotifier.testConnection();
        console.log('âœ… SUCCESS:', result.message);
    } catch (error) {
        console.log('âŒ FAILED:', error.message);
    }
}
```

---

## ðŸ“ **Documentation Rules**

### Rule #13: Code Documentation
- **Use JSDoc** for function documentation
- **Include usage examples** for complex functions
- **Document error conditions** and return values
- **Explain business logic** not just technical details

#### âœ… **Documentation Pattern:**
```javascript
/**
 * Analyzes email content for business relevance
 * @param {Object} email - Email object with from, subject, body
 * @returns {Object} Analysis result with isRelevant and cleanedMessage
 * @throws {Error} When AI provider is unavailable
 */
async function triageEmailContent(email) {
    // Implementation
}
```

### Rule #14: README Standards
Each module should have clear:
- **Purpose** and business value
- **Setup requirements** and dependencies  
- **Usage examples** with sample data
- **Error handling** and troubleshooting guides

---

## ðŸ”„ **Git Workflow Rules**

### Rule #15: Branch Strategy
- **Feature branches** for all new development
- **Descriptive branch names**: `add-slack-integration`, `fix-oauth-refresh`
- **Meaningful commit messages**: "Add Slack notification formatting"
- **No direct commits** to main branch

### Rule #16: Commit Standards
#### âœ… **Good Commit Messages:**
```
Add Slack webhook integration
Fix OAuth token refresh handling  
Update environment variable validation
Improve AI response error handling
```

#### ðŸš« **Avoid:**
```
Update files
Fix bug
WIP
Changes
```

---

## ðŸ”§ **Performance Rules**

### Rule #17: Async Operations
**MANDATORY**: Use async/await for all I/O operations.

#### âœ… **Async Pattern:**
```javascript
// âœ… Proper async handling
const emails = await Promise.all(
    emailIds.map(id => fetchEmailContent(id))
);

// âœ… Sequential when needed
for (const email of emails) {
    const result = await analyzeEmail(email);
    processResult(result);
}
```

### Rule #18: Batch Processing
- **Batch AI requests** when possible
- **Process emails in parallel** for fetching
- **Use sequential processing** for AI analysis to avoid rate limits
- **Implement timeouts** for long-running operations

---

## ðŸš€ **Deployment Rules**

### Rule #19: Environment Separation
- **Development**: Use `.env` files
- **Production**: Use environment variables or secure secret management
- **Never deploy** with development credentials
- **Validate configuration** before deployment

### Rule #20: Production Readiness
Before production deployment:
- âœ… All environment variables documented
- âœ… Error handling tested with various failure scenarios  
- âœ… Rate limiting and timeouts configured
- âœ… Monitoring and logging in place
- âœ… Backup and recovery procedures documented

---

## âš¡ **Quick Reference Checklist**

Before submitting any code changes:

- [ ] All sensitive values moved to environment variables
- [ ] `.env.example` updated with new variables
- [ ] Error handling follows graceful degradation pattern
- [ ] ES6 modules used with `.js` extensions
- [ ] No email content or credentials logged
- [ ] Test utilities created/updated for new features
- [ ] Documentation updated for API changes
- [ ] Branch named descriptively
- [ ] Commit message is clear and specific

---

## ðŸ“ž **When In Doubt**

1. **Read the memory bank** documentation first
2. **Check existing code** for established patterns
3. **Favor security** over convenience
4. **Prefer graceful degradation** over system failures
5. **Document your decisions** for future developers

Remember: This project handles sensitive email data and business communications. Security, privacy, and reliability are our top priorities.
